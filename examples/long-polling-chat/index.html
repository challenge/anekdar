<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>simple chat example</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <link rel="stylesheet" href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css" type="text/css">
    <link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Lato' type='text/css'>
    <style type="text/css" media="screen">
        body{background-color:#fff;color:#4D4D4D;font:15px/24px 'Lato',Arial,sans-serif; margin-top:20px;}
        p,h1,h2,h3{margin-bottom:20px;}
        p{font:inherit;}
        #messages {width: 500px;height: 400px;overflow-x: scroll;}
    </style>
    <script type="text/javascript">
    var publishUrl="http://localhost:9999/pub/chatroom";
    var subscribeUrl="http://localhost:9999/sub/chatroom";
    var nick="Guest_" + Math.floor((Math.random()*1000)+1);
        $(document).ready(function() {
            $('#messageForm').submit(function() {
                var chatMessage = $('#messageInput').val();
                if (chatMessage != "") {sendMessage(nick, chatMessage);};
                return false;
            });
            
            function getPayload() {
                $.getJSON(subscribeUrl, {}, function(data) {if (data != null) {updateMessages(data);};getPayload();});
            }
            
            function sendMessage (nick, chatMessage) {
                $.post(publishUrl, JSON.stringify({'event': 'message', 'nick': nick, 'message': chatMessage}), function(data, textStatus, xhr) {
                  $('#messageInput').val('');updateSubscriberCount(data);
                });
            }
            
            function updateSubscriberCount (data) {
                $('#userCount').text(data);
            }
            
            function updateMessages (data) {
                $('<p>' +  '<span class="label">' + htmlEncode(data.nick) + '</span> ' + htmlEncode(data.message) + '</p>').hide().prependTo("#messages").fadeIn();
            }
            
            function htmlEncode(value) {
                return $('<div/>').text(value).html();
            }
            
            sendMessage('Room message', nick + ' joined to channel');
            getPayload();
        });
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Chat example</h1>
        </header>
        <section>
            <div id="messages">
            
            </div>
            <form id="messageForm" action="" method="post" accept-charset="utf-8">
                <p>
                    <input id="messageInput" name="messageInput" value="">
                </p>
                <p>
                    <input id="sendMessageButton" type="submit" value="submit" class="btn btn-success">
                </p>
            </form>
        </section>
        <footer class="alert alert-info">
            <span id="userCount">?</span> users online!
        </footer>
    </div>
</body>
</html>